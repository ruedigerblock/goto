#!/bin/bash

USER=$(whoami)
RD_RESOLUTION=$(xrandr --current | grep "*" | awk '{print $1}'| head -1)
RD_OPTIONS="-r disk:$USER=$HOME -r sound:local -a 24 -x 0x80 -z -r clipboard:PRIMARYCLIPBOARD -K"

case $# in
  0)
    echo "where do you want to go today ?"
    exit 2
  ;;
  1) path_to_cfg="$1"
     host="$1"
  ;;
  2) path_to_cfg="$1/$2"
     host="$2"
  ;;
esac

if test ! -f ~/.goto/$path_to_cfg; then
  read -e -p "$host has no configuration file; create one ? (y/n) " -i "y" answer
  case $answer in
    y|Y|j|J|yy)
    echo "choose a category, press 'n' for none or enter new name"
    declare -a categories=($(find ~/.goto/* -type d | tr '\n' ' '))
    echo ${categories[2]}
    i=0
    for category in ${categories[@]}; do
      printf "%i) %s\n" $i ${category##*/}
      i=$((i+1))
    done
    printf "n) %s\n" "no-category"
    read -e -p "enter selection: " selection
    case $selection in
      [0-9]*)
        _folder=${categories[$selection]}
        folder=${_folder##*/}
      ;;
      n)
        folder="no-category"
      ;;
      *)
        folder=$selection
      ;;
     esac
     mkdir -pv ~/.goto/$folder
    ;;
  n)
    folder=.
  ;;
  esac
  echo "hostname=$host" >> ~/.goto/$folder/$host
fi

# get properties
source ~/.goto/$path_to_cfg

if [[ $hostname == "" ]] ; then
  hostname=$host
fi

case $type in
  ssh)
    ssh $username@$hostname
  ;;
  *)
   rdesktop $hostname -g $RD_RESOLUTION $RD_OPTIONS -u $username -p $password &
  ;;
esac

exit
